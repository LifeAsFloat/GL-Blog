<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>设置 - GL-Blog</title>
  <!-- 使用备用 CDN 源 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css" 
        onerror="this.onerror=null; this.href='https://unpkg.com/easymde/dist/easymde.min.css';">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background: #0a0a0a;
      min-height: 100vh;
      position: relative;
    }

    .bg-image {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
      opacity: 0.85;
    }

    .bg-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.6) 100%);
      z-index: 1;
    }

    /* 导航栏 - 完全照搬files.html */
    .card-nav-container {
      position: fixed;
      top: 2em;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 500px;
      z-index: 99;
    }

    .card-nav {
      display: block;
      height: 60px;
      padding: 0;
      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(40px) saturate(200%);
      -webkit-backdrop-filter: blur(40px) saturate(200%);
      border: 1px solid rgba(255, 255, 255, 0.4);
      border-radius: 0.75rem;
      position: relative;
      overflow: hidden;
      transition: height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-nav.open {
      height: 120px;
    }

    .card-nav-top {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 0.45rem 0.55rem 1.1rem;
      z-index: 2;
    }

    .hamburger-menu {
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      gap: 6px;
      color: #000;
    }

    .hamburger-line {
      width: 30px;
      height: 2px;
      background-color: currentColor;
      transition: transform 0.25s ease;
    }

    .hamburger-menu.open .hamburger-line:first-child {
      transform: translateY(4px) rotate(45deg);
    }

    .hamburger-menu.open .hamburger-line:last-child {
      transform: translateY(-4px) rotate(-45deg);
    }

    .logo-container {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      font-weight: 600;
      color: #000;
    }

    .card-nav-cta-button {
      background: rgba(0,0,0,0.05);
      color: #333;
      border: none;
      border-radius: calc(0.75rem - 0.35rem);
      padding: 0 1rem;
      height: 100%;
      display: flex;
      align-items: center;
      font-size: 0.9em;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .card-nav-cta-button:hover {
      background: rgba(0,0,0,0.1);
    }

    .card-nav-content {
      position: absolute;
      left: 0;
      right: 0;
      top: 60px;
      bottom: 0;
      padding: 0.5rem;
      display: flex;
      align-items: flex-end;
      gap: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .card-nav.open .card-nav-content {
      opacity: 1;
      pointer-events: auto;
    }

    .nav-card {
      height: 100%;
      flex: 1;
      border-radius: calc(0.75rem - 0.2rem);
      display: flex;
      align-items: center;
      justify-content: center;
      transform: translateY(20px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      color: inherit;
      padding: 0;
    }

    .nav-card .nav-card-label {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
    }

    .card-nav.open .nav-card {
      transform: translateY(0);
    }

    .nav-card:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    .nav-card-label {
      font-weight: 500;
      font-size: 18px;
      width: 100%;
      text-align: center;
    }

    /* 主容器 */
    .container {
      position: relative;
      z-index: 2;
      max-width: 1400px;
      margin: 0 auto;
      padding: 120px 20px 60px;
      display: flex;
      gap: 30px;
      transition: padding-top 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* 侧边栏 */
    .sidebar {
      width: 260px;
      flex-shrink: 0;
    }

    .sidebar-nav {
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(40px) saturate(200%);
      -webkit-backdrop-filter: blur(40px) saturate(200%);
      border: 1px solid rgba(255, 255, 255, 0.4);
      border-radius: 1rem;
      padding: 20px;
      box-shadow: 0 16px 56px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.15) inset;
      position: sticky;
      top: 120px;
    }

    .sidebar-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #000;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(0, 0, 0, 0.1);
    }

    .sidebar-item {
      padding: 12px 16px;
      margin-bottom: 8px;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      color: #666;
      font-weight: 500;
      user-select: none;
    }

    .sidebar-item:hover {
      background: rgba(0, 0, 0, 0.05);
      color: #000;
    }

    .sidebar-item.active {
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    /* 内容区 */
    .content {
      flex: 1;
      min-width: 0;
    }

    .content-page {
      display: none;
    }

    .content-page.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .page-title {
      display: none;
    }

    /* 卡片样式 */
    .card {
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(40px) saturate(200%);
      -webkit-backdrop-filter: blur(40px) saturate(200%);
      border: 1px solid rgba(255, 255, 255, 0.4);
      border-radius: 1rem;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 16px 56px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.15) inset;
    }

    .card-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: #000;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(0, 0, 0, 0.1);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #000;
    }

    .form-control {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid rgba(0, 0, 0, 0.1);
      border-radius: 0.5rem;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
    }

    .form-control:focus {
      outline: none;
      border-color: #000;
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.05);
    }

    textarea.form-control {
      resize: vertical;
      min-height: 120px;
      font-family: inherit;
    }

    select.form-control {
      cursor: pointer;
    }

    /* 按钮 */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #000000 0%, #333333 100%);
      color: #fff;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }

    .btn-secondary {
      background: rgba(0, 0, 0, 0.1);
      color: #000;
    }

    .btn-secondary:hover {
      background: rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
    }

    .btn-danger {
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      color: #fff;
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(220, 53, 69, 0.4);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn-loading {
      position: relative;
      pointer-events: none;
    }

    .btn-loading::after {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      top: 50%;
      right: 12px;
      margin-top: -8px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spinner 0.6s linear infinite;
    }

    @keyframes spinner {
      to { transform: rotate(360deg); }
    }

    /* 列表项 */
    .list-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(0, 0, 0, 0.03);
      border-radius: 0.5rem;
      margin-bottom: 8px;
    }

    .list-item-content {
      flex: 1;
      min-width: 0;
    }

    .list-item-actions {
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 0.3rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .icon-btn:hover {
      background: rgba(0, 0, 0, 0.1);
      transform: scale(1.1);
    }

    .icon-btn.danger:hover {
      background: rgba(220, 53, 69, 0.1);
      color: #dc3545;
    }

    /* 图片预览 */
    .image-preview {
      width: 150px;
      height: 150px;
      border-radius: 0.5rem;
      overflow: hidden;
      border: 2px solid rgba(0, 0, 0, 0.1);
      margin-top: 12px;
      background: rgba(0, 0, 0, 0.03);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .image-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }

    .image-preview.avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
    }

    .image-preview.avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* 上传区域 */
    .upload-area {
      display: flex;
      gap: 15px;
      align-items: flex-start;
    }

    .upload-input-wrapper {
      position: relative;
      flex: 1;
    }

    input[type="file"] {
      display: none;
    }

    .file-upload-btn {
      display: inline-block;
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.05);
      border: 2px dashed rgba(0, 0, 0, 0.2);
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      color: #666;
      font-weight: 500;
    }

    .file-upload-btn:hover {
      background: rgba(0, 0, 0, 0.08);
      border-color: #000;
      color: #000;
    }

    /* 社交链接 */
    .social-link-item {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      align-items: flex-start;
    }

    .social-link-item select {
      width: 150px;
      flex-shrink: 0;
    }

    .social-link-item input {
      flex: 1;
    }

    /* 标签/分类列表 */
    .tags-list, .categories-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 15px;
    }

    .tag-item, .category-item {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 14px;
      background: rgba(0, 0, 0, 0.08);
      border-radius: 2rem;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .tag-item button, .category-item button {
      border: none;
      background: none;
      cursor: pointer;
      color: #dc3545;
      font-size: 1.2rem;
      line-height: 1;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s ease;
    }

    .tag-item button:hover, .category-item button:hover {
      background: rgba(220, 53, 69, 0.1);
    }

    /* 消息提示 */
    .message {
      padding: 15px 20px;
      border-radius: 0.5rem;
      margin-bottom: 20px;
      display: none;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.show {
      display: block;
    }

    .message.success {
      background: rgba(40, 167, 69, 0.1);
      border: 1px solid rgba(40, 167, 69, 0.3);
      color: #155724;
    }

    .message.error {
      background: rgba(220, 53, 69, 0.1);
      border: 1px solid rgba(220, 53, 69, 0.3);
      color: #721c24;
    }

    /* 模态框 */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(8px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
      opacity: 0;
      transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .modal-overlay.show {
      display: flex;
      animation: fadeInModal 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    @keyframes fadeInModal {
      to {
        opacity: 1;
      }
    }

    .modal-content {
      background: white;
      border-radius: 1rem;
      padding: 40px;
      min-width: 400px;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transform: scale(0.9) translateY(20px);
      opacity: 0;
      animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes modalSlideIn {
      to {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    .modal-icon {
      width: 60px;
      height: 60px;
      margin: 0 auto 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
    }

    .modal-icon.success {
      background: linear-gradient(135deg, #000000 0%, #333333 100%);
      color: white;
    }

    .modal-icon.error {
      background: linear-gradient(135deg, #4a4a4a 0%, #6a6a6a 100%);
      color: white;
    }

    .modal-title {
      text-align: center;
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 15px;
    }

    .modal-message {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    .modal-button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #000000 0%, #333333 100%);
      color: white;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .modal-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }

    /* EasyMDE 自定义样式 */
    .EasyMDEContainer {
      margin-top: 10px;
    }

    .EasyMDEContainer .CodeMirror {
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid rgba(0, 0, 0, 0.1);
      border-radius: 0.5rem;
      min-height: 400px;
    }

    .EasyMDEContainer .CodeMirror-focused {
      border-color: #000;
      box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.05);
    }

    .editor-toolbar {
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid rgba(0, 0, 0, 0.1);
      border-bottom: none;
      border-radius: 0.5rem 0.5rem 0 0;
    }

    .editor-toolbar button {
      color: #333 !important;
    }

    .editor-toolbar button:hover {
      background: rgba(0, 0, 0, 0.05);
      border-color: transparent;
    }

    .editor-toolbar.fullscreen {
      background: rgba(255, 255, 255, 0.98);
    }

    /* 用户管理样式 */
    .table-container {
      overflow-x: auto;
      margin: 20px 0;
    }

    .users-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .users-table th,
    .users-table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    .users-table th {
      background: #f8f9fa;
      font-weight: 600;
      color: #333;
    }

    .users-table tr:hover {
      background: #f8f9fa;
    }

    .user-role {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .user-role.admin {
      background: #dc3545;
      color: white;
    }

    .user-role.owner {
      background: #6f42c1;
      color: white;
    }

    .user-role.user {
      background: #28a745;
      color: white;
    }

    .user-status {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .user-status.verified {
      background: #28a745;
      color: white;
    }

    .user-status.unverified {
      background: #ffc107;
      color: #333;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .stat-item {
      background: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .stat-number {
      font-size: 32px;
      font-weight: 700;
      color: #333;
      margin-bottom: 8px;
    }

    .stat-label {
      color: #666;
      font-size: 14px;
    }

    .user-actions {
      display: flex;
      gap: 8px;
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary.btn-sm {
      background: #007bff;
      color: white;
    }

    .btn-danger.btn-sm {
      background: #dc3545;
      color: white;
    }

    .btn-warning.btn-sm {
      background: #ffc107;
      color: #333;
    }
    
    /* 移动端优化 */
    @media (max-width: 768px) {
      /* 移动端导航栏不需要特殊样式，使用默认响应式设计 */
      
      /* 移动端显示侧边栏切换按钮 */
      .sidebar-toggle {
        display: flex !important;
      }
      
      /* 侧边栏折叠 */
      .sidebar {
        position: fixed;
        left: -280px;
        top: 0;
        bottom: 0;
        width: 280px;
        z-index: 110;
        transition: left 0.3s ease;
        background: transparent;
        backdrop-filter: none;
        box-shadow: none;
        pointer-events: auto;
      }
      
      .sidebar.open {
        left: 0;
      }
      
      /* 移动端侧边栏内容样式 */
      @media (max-width: 768px) {
        .sidebar .sidebar-nav {
          background: transparent;
          border: none;
          box-shadow: none;
          padding: 20px;
        }
        
        .sidebar .sidebar-item {
          color: #333;
          background: rgba(255, 255, 255, 0.9);
          margin-bottom: 12px;
          border-radius: 8px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
          backdrop-filter: blur(10px);
        }
        
        .sidebar .sidebar-item:hover {
          background: rgba(255, 255, 255, 0.95);
          color: #000;
          transform: translateY(-1px);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .sidebar .sidebar-item.active {
          background: rgba(0, 0, 0, 0.9);
          color: #fff;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
      }
      
      /* 侧边栏切换按钮 - 默认隐藏，只在移动端显示 */
      .sidebar-toggle {
        display: none;
        position: fixed;
        left: 10px;
        bottom: 20px;
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 50%;
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 110;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        outline: none;
        -webkit-tap-highlight-color: transparent;
      }
      
      .sidebar-toggle:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
      }
      
      .sidebar-toggle svg {
        width: 24px;
        height: 24px;
        stroke: #333;
      }
      
      /* 遮罩层 - 覆盖整个屏幕 */
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        z-index: 100;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: auto;
      }
      
      .sidebar-overlay.show {
        display: block;
        opacity: 1;
      }
      
      .main-content {
        margin-left: 0;
        padding: 100px 15px 40px;
      }
      
      .content-card {
        border-radius: 16px;
        padding: 25px;
      }
      
      .form-group label {
        font-size: 0.95rem;
      }
      
      .form-control, .form-textarea {
        font-size: 1rem;
        padding: 10px 14px;
      }
      
      .btn {
        padding: 10px 20px;
        font-size: 0.95rem;
      }
    }
    
    @media (max-width: 480px) {
      /* 导航栏保持与files.html完全一致，不覆盖任何样式 */
      
      .main-content {
        padding: 85px 12px 30px;
      }
      
      .content-card {
        border-radius: 14px;
        padding: 20px;
      }
      
      .sidebar {
        width: 260px;
        left: -260px;
      }
      
      .sidebar-toggle {
        width: 45px;
        height: 45px;
        left: 8px;
        bottom: 15px;
      }
    }
    
    /* 移除所有按钮和可点击元素的焦点轮廓 */
    button, a, input, select, textarea, [role="button"], [tabindex], .sidebar-item, .sidebar-toggle, .nav-card, .user-menu-item, .file-upload-btn, #avatarUpload, #bgUpload, .hamburger-menu {
      outline: none !important;
      -webkit-tap-highlight-color: transparent !important;
    }
    
    button:focus, a:focus, input:focus, select:focus, textarea:focus, [role="button"]:focus, [tabindex]:focus, .sidebar-item:focus, .sidebar-toggle:focus, .nav-card:focus, .user-menu-item:focus, .file-upload-btn:focus, #avatarUpload:focus, #bgUpload:focus, .hamburger-menu:focus {
      outline: none !important;
      box-shadow: none !important;
    }
  </style>
</head>
<body>
  <img class="bg-image" id="bgImage" src="/BG/BG.png" alt="背景">
  <div class="bg-overlay"></div>
  
  <!-- 侧边栏遮罩层 -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  
  <!-- 侧边栏切换按钮 - 只在移动端显示 -->
  <div class="sidebar-toggle" id="sidebarToggle" style="display: none;">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </div>

  <!-- 导航栏 -->
  <div class="card-nav-container">
    <nav class="card-nav" id="cardNav">
      <div class="card-nav-top">
        <div class="hamburger-menu" id="hamburger">
          <div class="hamburger-line"></div>
          <div class="hamburger-line"></div>
        </div>
        <div class="logo-container">
          <span id="siteName">GL-Blog 管理</span>
        </div>
        <a href="/" class="card-nav-cta-button" style="background: linear-gradient(135deg, #000000 0%, #333333 100%); color: #fff; display: flex; align-items: center; justify-content: center;">返回首页</a>
      </div>
      <div class="card-nav-content">
        <a href="/admin/posts" class="nav-card" style="background-color: #000000; color: #fff;">
          <div class="nav-card-label">文章</div>
        </a>
        <a href="/admin/files" class="nav-card" style="background-color: #333333; color: #fff;">
          <div class="nav-card-label">附件</div>
        </a>
        <a href="/admin/settings" class="nav-card" style="background-color: #666666; color: #fff;">
          <div class="nav-card-label">设置</div>
        </a>
      </div>
    </nav>
  </div>

  <div class="container">
    <!-- 侧边栏 -->
    <div class="sidebar">
      <div class="sidebar-nav">
        <div class="sidebar-title">设置导航</div>
        <div class="sidebar-item active" data-page="basic">基本设置</div>
        <div class="sidebar-item" data-page="users">用户管理</div>
        <div class="sidebar-item" data-page="smtp">SMTP配置</div>
        <div class="sidebar-item" data-page="about">关于页设置</div>
        <div class="sidebar-item" data-page="backup">备份与恢复</div>
      </div>
    </div>

    <!-- 内容区 -->
    <div class="content">
      <!-- 基本设置页面 -->
      <div class="content-page active" id="page-basic">
        <h1 class="page-title">基本设置</h1>

        <!-- 站点基本信息 -->
        <div class="card">
          <h2 class="card-title">站点信息</h2>
          <div class="form-group">
            <label>站点名称</label>
            <input type="text" id="siteName" class="form-control" placeholder="输入站点名称">
          </div>
          <div class="form-group">
            <label>站点创建时间</label>
            <div style="display: flex; gap: 12px; align-items: center;">
              <input type="number" id="siteYear" class="form-control" placeholder="年份" min="1999" max="2099" style="flex: 2;">
              <span style="color: #666;">年</span>
              <input type="number" id="siteMonth" class="form-control" placeholder="月" min="1" max="12" style="flex: 1;">
              <span style="color: #666;">月</span>
              <input type="number" id="siteDay" class="form-control" placeholder="日" min="1" max="31" style="flex: 1;">
              <span style="color: #666;">日</span>
            </div>
          </div>
          <div class="form-group">
            <label>联系邮箱（管理员账号绑定邮箱）</label>
            <div style="display: flex; gap: 12px;">
              <input type="email" id="emailAddress" class="form-control" disabled style="flex: 1;">
              <button type="button" class="btn btn-secondary" onclick="showChangeEmailModal()">换绑邮箱</button>
            </div>
          </div>
        </div>

        <!-- 个人信息 -->
        <div class="card">
          <h2 class="card-title">个人信息</h2>
          <div class="form-group">
            <label>昵称</label>
            <input type="text" id="nickname" class="form-control" placeholder="输入昵称">
          </div>
          <div class="form-group">
            <label>个人简介</label>
            <textarea id="bio" class="form-control" placeholder="一句话介绍自己"></textarea>
          </div>
          <div class="form-group">
            <label>头像</label>
            <div class="upload-area">
              <div class="upload-input-wrapper">
                <label for="avatarUpload" class="file-upload-btn">
                  点击选择头像图片
                </label>
                <input type="file" id="avatarUpload" accept="image/*">
              </div>
              <div class="image-preview avatar" id="avatarPreview">
                <img src="" alt="头像预览" style="display: none;">
              </div>
            </div>
          </div>
        </div>

        <!-- 社交链接 -->
        <div class="card">
          <h2 class="card-title">社交链接（固定4个）</h2>
          <div id="socialLinksContainer"></div>
        </div>

        <!-- 背景设置 -->
        <div class="card">
          <h2 class="card-title">背景图片</h2>
          <div class="form-group">
            <label>上传背景</label>
            <label for="bgUpload" class="file-upload-btn" style="display: block; max-width: 300px;">
              点击上传新背景
            </label>
            <input type="file" id="bgUpload" accept="image/*">
          </div>
          <div class="form-group">
            <label>预览效果</label>
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
              <div>
                <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">电脑端（16:9）</div>
                <div class="image-preview" id="bgPreviewDesktop" style="width: 320px; height: 180px;">
                  <img src="" alt="电脑端预览" style="display: none;">
                </div>
              </div>
              <div>
                <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">手机端（9:16）</div>
                <div class="image-preview" id="bgPreviewMobile" style="width: 180px; height: 320px;">
                  <img src="" alt="手机端预览" style="display: none;">
                </div>
              </div>
            </div>
          </div>
          <div class="btn-group">
            <button class="btn btn-secondary" onclick="resetBackground()">重置为默认背景</button>
          </div>
        </div>

        <!-- 公告设置 -->
        <div class="card">
          <h2 class="card-title">公告栏</h2>
          <div class="form-group">
            <label>公告内容</label>
            <textarea id="announcement" class="form-control" rows="3" placeholder="输入公告内容"></textarea>
          </div>
        </div>

        <!-- 分类管理 -->
        <div class="card">
          <h2 class="card-title">文章分类</h2>
          <div class="form-group">
            <label>添加新分类</label>
            <div style="display: flex; gap: 12px;">
              <input type="text" id="newCategory" class="form-control" placeholder="输入分类名称">
              <button class="btn btn-primary" onclick="addCategory()">添加</button>
            </div>
          </div>
          <div class="categories-list" id="categoriesList"></div>
        </div>

        <!-- 标签管理 -->
        <div class="card">
          <h2 class="card-title">文章标签</h2>
          <div class="form-group">
            <label>添加新标签</label>
            <div style="display: flex; gap: 12px;">
              <input type="text" id="newTag" class="form-control" placeholder="输入标签名称">
              <button class="btn btn-primary" onclick="addTag()">添加</button>
            </div>
          </div>
          <div class="tags-list" id="tagsList"></div>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" onclick="saveBasicSettings(event)">保存所有设置</button>
        </div>
      </div>

      <!-- 用户管理页面 -->
      <div class="content-page" id="page-users">
        <h1 class="page-title">用户管理</h1>

        <!-- 用户列表 -->
        <div class="card">
          <h2 class="card-title">用户列表</h2>
          <div class="table-container">
            <table class="users-table">
              <thead>
                <tr>
                  <th>用户ID</th>
                  <th>用户名</th>
                  <th>邮箱</th>
                  <th>昵称</th>
                  <th>角色</th>
                  <th>注册时间</th>
                  <th>状态</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <!-- 用户数据将通过JavaScript动态加载 -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- 用户统计 -->
        <div class="card">
          <h2 class="card-title">用户统计</h2>
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-number" id="totalUsers">0</div>
              <div class="stat-label">总用户数</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="adminUsers">0</div>
              <div class="stat-label">管理员</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="regularUsers">0</div>
              <div class="stat-label">普通用户</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="verifiedUsers">0</div>
              <div class="stat-label">已验证用户</div>
            </div>
          </div>
        </div>
      </div>

      <!-- SMTP配置页面 -->
      <div class="content-page" id="page-smtp">
        <h1 class="page-title">SMTP 邮箱配置</h1>

        <div class="card">
          <h2 class="card-title">邮件服务器设置</h2>
          <div class="form-group">
            <label>SMTP 服务器地址</label>
            <input type="text" id="smtpServer" class="form-control" placeholder="smtp.example.com">
          </div>
          <div class="form-group">
            <label>SMTP 端口</label>
            <input type="number" id="smtpPort" class="form-control" placeholder="465">
          </div>
          <div class="form-group">
            <label>发件人邮箱</label>
            <input type="email" id="smtpUsername" class="form-control" placeholder="your@email.com">
          </div>
          <div class="form-group">
            <label>邮箱密码/授权码</label>
            <div style="position: relative;">
              <input type="password" id="smtpPassword" class="form-control" placeholder="输入密码或授权码" style="padding-right: 45px;">
              <button type="button" onclick="togglePasswordVisibility()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; padding: 5px; display: flex; align-items: center; justify-content: center;">
                <svg id="passwordToggleIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
            </div>
          </div>
          <div class="form-group">
            <label>发件人显示名称</label>
            <input type="text" id="smtpDisplayName" class="form-control" placeholder="GL-Blog">
          </div>
          <div class="form-group">
            <label>加密方式</label>
            <select id="smtpEncryption" class="form-control">
              <option value="SSL">SSL</option>
              <option value="TLS">TLS</option>
              <option value="NONE">无加密</option>
            </select>
          </div>
          <div class="btn-group">
            <button class="btn btn-secondary" onclick="testSMTP(event)">测试配置</button>
            <button class="btn btn-primary" onclick="saveSMTPConfig(event)">保存配置</button>
          </div>
        </div>
      </div>

      <!-- 关于页设置 -->
      <div class="content-page" id="page-about">
        <h1 class="page-title">关于页设置</h1>

        <div class="card">
          <h2 class="card-title">页面内容</h2>
          <div class="form-group">
            <label>页面标题</label>
            <input type="text" id="aboutTitle" class="form-control" placeholder="关于本站">
          </div>
          <div class="form-group">
            <label>页面内容 (支持Markdown)</label>
            <textarea id="aboutContent" class="form-control"></textarea>
          </div>
          <div class="btn-group">
            <button class="btn btn-primary" onclick="saveAboutPage(event)">保存关于页</button>
          </div>
        </div>
      </div>

      <!-- 备份与恢复 -->
      <div class="content-page" id="page-backup">
        <h1 class="page-title">备份与恢复</h1>

        <div class="card">
          <h2 class="card-title">数据管理</h2>
          <p style="color: #666; margin-bottom: 20px;">
            导出功能会将所有文章、设置、上传文件打包成 .tar.gz 文件，方便您迁移数据。
          </p>
          <div class="btn-group">
            <button class="btn btn-primary" onclick="exportData()">导出所有数据</button>
            <button class="btn btn-secondary" onclick="document.getElementById('importInput').click()">导入数据</button>
            <input type="file" id="importInput" accept=".tar.gz" style="display: none;" onchange="importData(this)">
          </div>
        </div>

        <div class="card">
          <h2 class="card-title" style="color: #dc3545;">危险操作</h2>
          <p style="color: #666; margin-bottom: 20px;">
            重置站点会清空所有数据，包括文章、设置、上传文件等，并恢复到初始状态。此操作不可逆！
          </p>
          <button class="btn btn-danger" onclick="confirmReset()">重置站点</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 换绑邮箱模态框 -->
  <div id="changeEmailModal" class="modal-overlay" onclick="closeChangeEmailModal()" style="display: none;">
    <div class="modal-content" onclick="event.stopPropagation()">
      <h2 class="modal-title">换绑邮箱</h2>
      <form id="changeEmailForm" style="text-align: left;">
        <div class="form-group">
          <label>新邮箱地址</label>
          <input type="email" id="newEmail" class="form-control" placeholder="输入新的邮箱地址" required>
        </div>
        <div class="form-group">
          <label>验证码</label>
          <div style="display: flex; gap: 12px;">
            <input type="text" id="emailVerifyCode" class="form-control" placeholder="输入验证码" required style="flex: 1;">
            <button type="button" class="verify-btn" id="sendEmailCodeBtn" onclick="sendEmailCode()">发送验证码</button>
          </div>
        </div>
        <div style="display: flex; gap: 12px; justify-content: flex-end;">
          <button type="button" class="btn btn-secondary" onclick="closeChangeEmailModal()">取消</button>
          <button type="submit" class="btn btn-primary">确认换绑</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 模态框 -->
  <div id="modalOverlay" class="modal-overlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div id="modalIcon" class="modal-icon success">✓</div>
      <h2 id="modalTitle" class="modal-title">成功</h2>
      <p id="modalMessage" class="modal-message">操作已完成</p>
      <button class="modal-button" onclick="closeModal()">确定</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.js" 
          onerror="this.onerror=null; this.src='https://unpkg.com/easymde/dist/easymde.min.js';"></script>
  <script>
    // 导航栏交互
    const hamburger = document.getElementById('hamburger');
    const cardNav = document.getElementById('cardNav');
    let isOpen = false;

    const container = document.querySelector('.container');
    
    hamburger.addEventListener('click', () => {
      isOpen = !isOpen;
      hamburger.classList.toggle('open', isOpen);
      cardNav.classList.toggle('open', isOpen);
      
      // 添加下串动画
      if (isOpen) {
        container.style.paddingTop = '200px';
      } else {
        container.style.paddingTop = '120px';
      }
    });

    // 侧边栏导航
    const sidebarItems = document.querySelectorAll('.sidebar-item');
    const contentPages = document.querySelectorAll('.content-page');

    sidebarItems.forEach(item => {
      item.addEventListener('click', () => {
        const pageId = item.getAttribute('data-page');
        
        // 更新侧边栏激活状态
        sidebarItems.forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        // 更新内容页
        contentPages.forEach(page => page.classList.remove('active'));
        document.getElementById(`page-${pageId}`).classList.add('active');
        
        // 根据页面类型加载相应数据
        if (pageId === 'smtp') {
          loadSMTPConfig();
        } else if (pageId === 'about') {
          if (!aboutEditor) {
            initAboutEditor();
          }
          loadAboutPage();
        } else if (pageId === 'users') {
          loadUsers();
        }
      });
    });

    // 初始化 EasyMDE
    let aboutEditor = null;
    
    function initAboutEditor() {
      if (aboutEditor) return;
      
      // 检查 EasyMDE 是否已加载
      if (typeof EasyMDE === 'undefined') {
        console.error('EasyMDE 未加载，请检查网络连接或 CDN 可用性');
        // 创建一个简单的 textarea 作为降级方案
        const textarea = document.getElementById('aboutContent');
        if (textarea) {
          textarea.placeholder = '在这里编写关于页内容...（编辑器加载失败，使用纯文本编辑）';
          textarea.style.minHeight = '400px';
        }
        return;
      }
      
      aboutEditor = new EasyMDE({
        element: document.getElementById('aboutContent'),
        spellChecker: false,
        placeholder: '在这里编写关于页内容...',
        minHeight: '400px',
        toolbar: [
          { name: 'bold', action: EasyMDE.toggleBold, className: 'fa fa-bold', title: '粗体 (Ctrl-B)' },
          { name: 'italic', action: EasyMDE.toggleItalic, className: 'fa fa-italic', title: '斜体 (Ctrl-I)' },
          { name: 'heading', action: EasyMDE.toggleHeadingSmaller, className: 'fa fa-header', title: '标题 (Ctrl-H)' },
          '|',
          { name: 'quote', action: EasyMDE.toggleBlockquote, className: 'fa fa-quote-left', title: '引用 (Ctrl-\')' },
          { name: 'unordered-list', action: EasyMDE.toggleUnorderedList, className: 'fa fa-list-ul', title: '无序列表 (Ctrl-L)' },
          { name: 'ordered-list', action: EasyMDE.toggleOrderedList, className: 'fa fa-list-ol', title: '有序列表 (Ctrl-Alt-L)' },
          { name: 'code', action: EasyMDE.toggleCodeBlock, className: 'fa fa-code', title: '代码块 (Ctrl-Alt-C)' },
          '|',
          { name: 'link', action: EasyMDE.drawLink, className: 'fa fa-link', title: '插入链接 (Ctrl-K)' },
          { name: 'image', action: EasyMDE.drawImage, className: 'fa fa-picture-o', title: '插入图片 (Ctrl-Alt-I)' },
          { name: 'table', action: EasyMDE.drawTable, className: 'fa fa-table', title: '插入表格' },
          '|',
          { name: 'preview', action: EasyMDE.togglePreview, className: 'fa fa-eye no-disable', title: '预览 (Ctrl-P)' },
          { name: 'side-by-side', action: EasyMDE.toggleSideBySide, className: 'fa fa-columns no-disable no-mobile', title: '分屏预览 (F9)' },
          { name: 'fullscreen', action: EasyMDE.toggleFullScreen, className: 'fa fa-arrows-alt no-disable no-mobile', title: '全屏 (F11)' }
        ]
      });
    }

    // 社交链接平台列表
    const socialPlatforms = [
      'GitHub', 'Bilibili', 'Email', 'Douyin', 'Weibo', 'Douban', 
      'Zhihu', 'TikTok', 'Telegram', 'Facebook', 'YouTube', 
      'Discord', 'Twitter', 'Steam'
    ];

    let socialLinks = [];
    let categories = [];
    let tags = [];
    let bgFile = null;
    let avatarFile = null;

    // 渲染社交链接（固定4个）
    function renderSocialLinks() {
      // 确保有4个社交链接
      while (socialLinks.length < 4) {
        socialLinks.push({ platform: 'GitHub', url: '' });
      }
      if (socialLinks.length > 4) {
        socialLinks = socialLinks.slice(0, 4);
      }
      
      const container = document.getElementById('socialLinksContainer');
      container.innerHTML = socialLinks.map((link, index) => `
        <div class="social-link-item">
          <label style="min-width: 80px; font-weight: 500;">位置 ${index + 1}</label>
          <select class="form-control" onchange="updateSocialLinkPlatform(${index}, this.value)">
            ${socialPlatforms.map(p => `
              <option value="${p}" ${link.platform === p ? 'selected' : ''}>${p}</option>
            `).join('')}
          </select>
          <input type="url" class="form-control" value="${link.url}" 
                 placeholder="输入链接地址" 
                 onchange="updateSocialLinkUrl(${index}, this.value)">
        </div>
      `).join('');
    }

    function updateSocialLinkPlatform(index, platform) {
      socialLinks[index].platform = platform;
    }

    function updateSocialLinkUrl(index, url) {
      socialLinks[index].url = url;
    }

    // 添加分类
    function addCategory() {
      const input = document.getElementById('newCategory');
      const value = input.value.trim();
      if (value && !categories.includes(value)) {
        categories.push(value);
        renderCategories();
        input.value = '';
      }
    }

    // 删除分类
    function removeCategory(cat) {
      categories = categories.filter(c => c !== cat);
      renderCategories();
    }

    // 渲染分类
    function renderCategories() {
      const container = document.getElementById('categoriesList');
      container.innerHTML = categories.map(cat => `
        <div class="category-item">
          ${cat}
          <button onclick="removeCategory('${cat}')">✕</button>
        </div>
      `).join('');
    }

    // 添加标签
    function addTag() {
      const input = document.getElementById('newTag');
      const value = input.value.trim();
      if (value && !tags.includes(value)) {
        tags.push(value);
        renderTags();
        input.value = '';
      }
    }

    // 删除标签
    function removeTag(tag) {
      tags = tags.filter(t => t !== tag);
      renderTags();
    }

    // 渲染标签
    function renderTags() {
      const container = document.getElementById('tagsList');
      container.innerHTML = tags.map(tag => `
        <div class="tag-item">
          ${tag}
          <button onclick="removeTag('${tag}')">✕</button>
        </div>
      `).join('');
    }

    // 文件上传处理
    document.getElementById('avatarUpload').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        avatarFile = file;
        const reader = new FileReader();
        reader.onload = (e) => {
          const preview = document.getElementById('avatarPreview');
          const img = preview.querySelector('img');
          img.src = e.target.result;
          img.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    document.getElementById('bgUpload').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        bgFile = file;
        const reader = new FileReader();
        reader.onload = (e) => {
          const desktopPreview = document.getElementById('bgPreviewDesktop');
          const mobilePreview = document.getElementById('bgPreviewMobile');
          
          const desktopImg = desktopPreview.querySelector('img');
          const mobileImg = mobilePreview.querySelector('img');
          
          desktopImg.src = e.target.result;
          mobileImg.src = e.target.result;
          
          desktopImg.style.display = 'block';
          mobileImg.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    // 加载设置
    async function loadSettings() {
      try {
        const res = await fetch('/api/settings');
        const data = await res.json();
        
        // 基本设置
        document.getElementById('siteName').value = data.siteName || '';
        
        // 解析站点创建时间
        if (data.siteStartDate) {
          const [year, month, day] = data.siteStartDate.split('-');
          document.getElementById('siteYear').value = year || '';
          document.getElementById('siteMonth').value = parseInt(month) || '';
          document.getElementById('siteDay').value = parseInt(day) || '';
        }
        
        // 加载管理员邮箱
        loadAdminEmail();
        
        // 个人信息
        document.getElementById('nickname').value = data.nickname || '';
        document.getElementById('bio').value = data.bio || '';
        
        if (data.avatar) {
          const preview = document.getElementById('avatarPreview');
          const img = preview.querySelector('img');
          img.src = data.avatar;
          img.style.display = 'block';
        }
        
        // 社交链接 - 确保有默认值
        if (data.socialLinks && data.socialLinks.length > 0) {
          socialLinks = data.socialLinks;
        } else {
          // 如果没有社交链接，使用默认值（带实际跳转链接）
          socialLinks = [
            { platform: 'GitHub', url: 'https://github.com/Lihu-PR' },
            { platform: 'Bilibili', url: 'https://space.bilibili.com/305674742' },
            { platform: 'Email', url: 'mailto:17192413622@163.com' },
            { platform: 'Douyin', url: 'https://www.douyin.com/user/MS4wLjABAAAAEpo7zO7BLFarRWgMsew-oyw2WeDmgaNL-bjeVFEusNU?from_tab_name=main' }
          ];
        }
        renderSocialLinks();
        
        // 背景 - 显示当前背景或默认背景
        const bgUrl = data.customBackground || '/BG/BG.png';
        const desktopPreview = document.getElementById('bgPreviewDesktop');
        const mobilePreview = document.getElementById('bgPreviewMobile');
        
        const desktopImg = desktopPreview.querySelector('img');
        const mobileImg = mobilePreview.querySelector('img');
        
        desktopImg.src = bgUrl;
        mobileImg.src = bgUrl;
        
        desktopImg.style.display = 'block';
        mobileImg.style.display = 'block';
        
        // 公告
        document.getElementById('announcement').value = data.announcement || '';
        
        // 分类和标签
        categories = data.categories || [];
        tags = data.tags || [];
        renderCategories();
        renderTags();
        
      } catch (error) {
        console.error('加载设置失败:', error);
      }
    }

    // 加载SMTP配置
    async function loadSMTPConfig() {
      try {
        const res = await fetch('/api/smtp-config');
        const data = await res.json();
        
        document.getElementById('smtpServer').value = data.server || '';
        document.getElementById('smtpPort').value = data.port || '';
        document.getElementById('smtpUsername').value = data.username || '';
        document.getElementById('smtpPassword').value = data.password || '';
        document.getElementById('smtpDisplayName').value = data.displayName || '';
        document.getElementById('smtpEncryption').value = data.encryption || 'SSL';
        
      } catch (error) {
        console.error('加载SMTP配置失败:', error);
      }
    }

    // 加载关于页
    async function loadAboutPage() {
      try {
        const res = await fetch('/api/about-page');
        const data = await res.json();
        
        document.getElementById('aboutTitle').value = data.title || '';
        
        if (!aboutEditor) {
          initAboutEditor();
        }
        
        // 设置内容 - 如果有编辑器使用编辑器，否则使用 textarea
        if (aboutEditor && typeof aboutEditor.value === 'function') {
          aboutEditor.value(data.content || '');
        } else {
          const textarea = document.getElementById('aboutContent');
          if (textarea) {
            textarea.value = data.content || '';
          }
        }
        
      } catch (error) {
        console.error('加载关于页失败:', error);
      }
    }

    // 保存基本设置
    async function saveBasicSettings(event) {
      const btn = event.target;
      const originalText = btn.textContent;
      
      try {
        btn.disabled = true;
        btn.classList.add('btn-loading');
        btn.textContent = '保存中...';
        
        // 验证并组合日期
        const year = parseInt(document.getElementById('siteYear').value);
        const month = parseInt(document.getElementById('siteMonth').value);
        const day = parseInt(document.getElementById('siteDay').value);
        
        if (year && month && day) {
          // 验证年份
          if (year < 1999 || year > 2099) {
            showModal('error', '验证失败', '年份必须在1999-2099之间');
            btn.disabled = false;
            btn.classList.remove('btn-loading');
            btn.textContent = originalText;
            return;
          }
          
          // 验证月份
          if (month < 1 || month > 12) {
            showModal('error', '验证失败', '月份必须在1-12之间');
            btn.disabled = false;
            btn.classList.remove('btn-loading');
            btn.textContent = originalText;
            return;
          }
          
          // 验证日期
          const daysInMonth = new Date(year, month, 0).getDate();
          if (day < 1 || day > daysInMonth) {
            showModal('error', '验证失败', `${year}年${month}月只有${daysInMonth}天`);
            btn.disabled = false;
            btn.classList.remove('btn-loading');
            btn.textContent = originalText;
            return;
          }
        }
        
        const siteStartDate = (year && month && day) 
          ? `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`
          : '';
        
        const settings = {
          siteName: document.getElementById('siteName').value,
          siteStartDate: siteStartDate,
          nickname: document.getElementById('nickname').value,
          bio: document.getElementById('bio').value,
          socialLinks: socialLinks,
          announcement: document.getElementById('announcement').value,
          categories: categories,
          tags: tags
        };
        
        // 上传头像
        if (avatarFile) {
          const formData = new FormData();
          formData.append('file', avatarFile);
          const uploadRes = await fetch('/api/upload', {
            method: 'POST',
            body: formData
          });
          if (uploadRes.ok) {
            const data = await uploadRes.json();
            settings.avatar = data.url;
          }
        }
        
        // 上传背景
        if (bgFile) {
          const formData = new FormData();
          formData.append('background', bgFile);
          await fetch('/api/upload-background', {
            method: 'POST',
            body: formData
          });
        }
        
        const res = await fetch('/api/settings', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(settings)
        });
        
        if (res.ok) {
          showModal('success', '保存成功', '所有设置已成功保存！');
          avatarFile = null;
          bgFile = null;
        } else {
          throw new Error('保存失败');
        }
        
      } catch (error) {
        showModal('error', '保存失败', error.message);
      } finally {
        btn.disabled = false;
        btn.classList.remove('btn-loading');
        btn.textContent = originalText;
      }
    }

    // 测试SMTP
    async function testSMTP(event) {
      const btn = event.target;
      const originalText = btn.textContent;
      
      try {
        btn.disabled = true;
        btn.classList.add('btn-loading');
        btn.textContent = '测试中...';
        
        const config = {
          server: document.getElementById('smtpServer').value,
          port: parseInt(document.getElementById('smtpPort').value),
          username: document.getElementById('smtpUsername').value,
          password: document.getElementById('smtpPassword').value,
          displayName: document.getElementById('smtpDisplayName').value,
          encryption: document.getElementById('smtpEncryption').value
        };
        
        const res = await fetch('/api/test-smtp', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(config)
        });
        
        if (res.ok) {
          showModal('success', '测试成功', '测试邮件已发送，请检查收件箱！');
        } else {
          const error = await res.text();
          throw new Error(error);
        }
        
      } catch (error) {
        showModal('error', '测试失败', error.message);
      } finally {
        btn.disabled = false;
        btn.classList.remove('btn-loading');
        btn.textContent = originalText;
      }
    }

    // 保存SMTP配置
    async function saveSMTPConfig(event) {
      const btn = event.target;
      const originalText = btn.textContent;
      
      try {
        btn.disabled = true;
        btn.classList.add('btn-loading');
        btn.textContent = '保存中...';
        
        const config = {
          server: document.getElementById('smtpServer').value,
          port: parseInt(document.getElementById('smtpPort').value),
          username: document.getElementById('smtpUsername').value,
          displayName: document.getElementById('smtpDisplayName').value,
          encryption: document.getElementById('smtpEncryption').value
        };
        
        const password = document.getElementById('smtpPassword').value;
        if (password) {
          config.password = password;
        }
        
        const res = await fetch('/api/smtp-config', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(config)
        });
        
        if (res.ok) {
          showModal('success', '保存成功', 'SMTP配置已成功保存！');
          // 保存成功后重新加载SMTP配置，保留密码显示
          await loadSMTPConfig();
        } else {
          throw new Error('保存失败');
        }
        
      } catch (error) {
        showModal('error', '保存失败', error.message);
      } finally {
        btn.disabled = false;
        btn.classList.remove('btn-loading');
        btn.textContent = originalText;
      }
    }

    // 保存关于页
    async function saveAboutPage(event) {
      const btn = event.target;
      const originalText = btn.textContent;
      
      try {
        btn.disabled = true;
        btn.classList.add('btn-loading');
        btn.textContent = '保存中...';
        
        // 获取内容 - 如果有编辑器使用编辑器，否则使用 textarea
        let content = '';
        if (aboutEditor && typeof aboutEditor.value === 'function') {
          content = aboutEditor.value();
        } else {
          const textarea = document.getElementById('aboutContent');
          content = textarea ? textarea.value : '';
        }
        
        const data = {
          title: document.getElementById('aboutTitle').value,
          content: content
        };
        
        const res = await fetch('/api/about-page', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
        
        if (res.ok) {
          showModal('success', '保存成功', '关于页内容已成功保存！');
        } else {
          throw new Error('保存失败');
        }
        
      } catch (error) {
        showModal('error', '保存失败', error.message);
      } finally {
        btn.disabled = false;
        btn.classList.remove('btn-loading');
        btn.textContent = originalText;
      }
    }

    // 重置背景
    async function resetBackground() {
      try {
        const res = await fetch('/api/reset-background', {
          method: 'POST'
        });
        
        if (res.ok) {
          showModal('success', '重置成功', '背景已重置为默认！');
          
          // 更新背景图片（如果存在）
          const bgImage = document.getElementById('bgImage');
          if (bgImage) {
            bgImage.src = '/BG/BG.png';
          }
          
          // 更新桌面端预览
          const desktopPreview = document.getElementById('bgPreviewDesktop');
          if (desktopPreview) {
            const desktopImg = desktopPreview.querySelector('img');
            if (desktopImg) {
              desktopImg.src = '/BG/BG.png';
              desktopImg.style.display = 'block';
            }
          }
          
          // 更新移动端预览
          const mobilePreview = document.getElementById('bgPreviewMobile');
          if (mobilePreview) {
            const mobileImg = mobilePreview.querySelector('img');
            if (mobileImg) {
              mobileImg.src = '/BG/BG.png';
              mobileImg.style.display = 'block';
            }
          }
          
          bgFile = null;
          
          // 重新加载设置以更新所有预览
          await loadSettings();
        }
      } catch (error) {
        showModal('error', '重置失败', error.message);
      }
    }

    // 导出数据
    async function exportData() {
      try {
        const res = await fetch('/api/export-data');
        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'gl-blog-backup.tar.gz';
        a.click();
        window.URL.revokeObjectURL(url);
        showModal('success', '导出成功', '数据已成功导出！');
      } catch (error) {
        showModal('error', '导出失败', error.message);
      }
    }

    // 导入数据
    async function importData(input) {
      const file = input.files[0];
      if (!file) return;
      
      try {
        const formData = new FormData();
        formData.append('file', file);
        
        const res = await fetch('/api/import-data', {
          method: 'POST',
          body: formData
        });
        
        if (res.ok) {
          showModal('success', '导入成功', '数据已成功导入！页面将在3秒后刷新...');
          setTimeout(() => location.reload(), 3000);
        } else {
          throw new Error('导入失败');
        }
      } catch (error) {
        showModal('error', '导入失败', error.message);
      }
      input.value = '';
    }

    // 确认重置
    function confirmReset() {
      if (confirm('⚠️ 确定要重置站点吗？此操作将清空所有数据且不可恢复！\n\n请输入"RESET"确认：')) {
        const input = prompt('请输入"RESET"确认重置：');
        if (input === 'RESET') {
          resetSite();
        }
      }
    }

    // 重置站点
    async function resetSite() {
      try {
        const res = await fetch('/api/reset-site', {
          method: 'POST'
        });
        
        if (res.ok) {
          showModal('success', '重置成功', '站点已重置！页面将跳转到初始设置...');
          setTimeout(() => location.href = '/', 2000);
        } else {
          throw new Error('重置失败');
        }
      } catch (error) {
        showModal('error', '重置失败', error.message);
      }
    }

    // 显示模态框
    function showModal(type, title, message) {
      const overlay = document.getElementById('modalOverlay');
      const icon = document.getElementById('modalIcon');
      const titleEl = document.getElementById('modalTitle');
      const messageEl = document.getElementById('modalMessage');
      
      if (type === 'success') {
        icon.className = 'modal-icon success';
        icon.textContent = '✓';
      } else if (type === 'error') {
        icon.className = 'modal-icon error';
        icon.textContent = '✕';
      }
      
      titleEl.textContent = title;
      messageEl.textContent = message;
      
      overlay.classList.add('show');
    }

    // 关闭模态框
    function closeModal() {
      const overlay = document.getElementById('modalOverlay');
      overlay.classList.remove('show');
    }

    // 加载管理员邮箱
    async function loadAdminEmail() {
      try {
        const res = await fetch('/api/user-info');
        if (res.ok) {
          const user = await res.json();
          document.getElementById('emailAddress').value = user.email || '';
        }
      } catch (error) {
        console.error('加载管理员邮箱失败:', error);
      }
    }

    // 显示换绑邮箱模态框
    function showChangeEmailModal() {
      document.getElementById('changeEmailModal').style.display = 'flex';
      document.getElementById('newEmail').value = '';
      document.getElementById('emailVerifyCode').value = '';
    }

    // 关闭换绑邮箱模态框
    function closeChangeEmailModal() {
      document.getElementById('changeEmailModal').style.display = 'none';
    }

    // 发送换绑邮箱验证码
    let emailCountdown = 0;
    
    async function sendEmailCode() {
      if (emailCountdown > 0) return;
      
      const btn = document.getElementById('sendEmailCodeBtn');
      const email = document.getElementById('newEmail').value;
      
      if (!email) {
        showModal('error', '错误', '请输入新邮箱地址');
        return;
      }
      
      try {
        btn.disabled = true;
        
        const response = await fetch('/api/send-verification-code', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            email: email,
            type: 'email-change'
          })
        });
        
        if (response.ok) {
          showModal('success', '发送成功', '验证码已发送到新邮箱');
          emailCountdown = 60;
          updateEmailCountdown();
        } else {
          const error = await response.text();
          showModal('error', '发送失败', error);
          btn.disabled = false;
        }
      } catch (error) {
        showModal('error', '发送失败', error.message);
        btn.disabled = false;
      }
    }
    
    function updateEmailCountdown() {
      const btn = document.getElementById('sendEmailCodeBtn');
      if (emailCountdown > 0) {
        btn.textContent = `${emailCountdown}秒后重试`;
        emailCountdown--;
        setTimeout(updateEmailCountdown, 1000);
      } else {
        btn.textContent = '发送验证码';
        btn.disabled = false;
      }
    }

    // 换绑邮箱表单提交
    document.getElementById('changeEmailForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const newEmail = document.getElementById('newEmail').value;
      const code = document.getElementById('emailVerifyCode').value;
      
      try {
        const response = await fetch('/api/change-email', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            newEmail: newEmail,
            code: code
          })
        });
        
        if (response.ok) {
          showModal('success', '换绑成功', '邮箱已成功换绑！');
          closeChangeEmailModal();
          loadAdminEmail();
        } else {
          const error = await response.text();
          showModal('error', '换绑失败', error);
        }
      } catch (error) {
        showModal('error', '换绑失败', error.message);
      }
    });

    // 切换密码显示/隐藏
    function togglePasswordVisibility() {
      const passwordInput = document.getElementById('smtpPassword');
      const icon = document.getElementById('passwordToggleIcon');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        // 眼睛关闭图标
        icon.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>';
      } else {
        passwordInput.type = 'password';
        // 眼睛睁开图标
        icon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
      }
    }

    // 初始化
    loadSettings();
    loadSMTPConfig();
    
    // 用户管理功能
    async function loadUsers() {
      try {
        const res = await fetch('/api/users');
        const users = await res.json();
        
        // 更新统计数据
        const totalUsers = users.length;
        const adminUsers = users.filter(u => u.isAdmin).length;
        const regularUsers = totalUsers - adminUsers;
        const verifiedUsers = users.filter(u => u.verified).length;
        
        document.getElementById('totalUsers').textContent = totalUsers;
        document.getElementById('adminUsers').textContent = adminUsers;
        document.getElementById('regularUsers').textContent = regularUsers;
        document.getElementById('verifiedUsers').textContent = verifiedUsers;
        
        // 更新用户表格
        const tbody = document.getElementById('usersTableBody');
        tbody.innerHTML = '';
        
        users.forEach((user, index) => {
          const row = document.createElement('tr');
          const isOwner = index === 0; // 第一个用户是站长
          
          row.innerHTML = `
            <td>${user.id.substring(0, 8)}...</td>
            <td>${user.username}</td>
            <td>${user.email}</td>
            <td>${user.nickname || '-'}</td>
            <td>
              <span class="user-role ${isOwner ? 'owner' : (user.isAdmin ? 'admin' : 'user')}">
                ${isOwner ? '站长' : (user.isAdmin ? '管理员' : '普通用户')}
              </span>
            </td>
            <td>${new Date(user.createdAt).toLocaleDateString('zh-CN')}</td>
            <td>
              <span class="user-status ${user.verified ? 'verified' : 'unverified'}">
                ${user.verified ? '已验证' : '未验证'}
              </span>
            </td>
            <td>
              <div class="user-actions">
                ${!isOwner ? `
                  <button class="btn-sm ${user.isAdmin ? 'btn-warning' : 'btn-primary'}" 
                          onclick="toggleUserRole('${user.id}', ${!user.isAdmin})">
                    ${user.isAdmin ? '取消管理员' : '设为管理员'}
                  </button>
                  <button class="btn-sm btn-danger" onclick="deleteUser('${user.id}')">删除</button>
                ` : '<span style="color: #666;">站长</span>'}
              </div>
            </td>
          `;
          
          tbody.appendChild(row);
        });
        
      } catch (error) {
        console.error('加载用户列表失败:', error);
        showModal('error', '加载失败', '无法加载用户列表');
      }
    }
    
    async function toggleUserRole(userId, makeAdmin) {
      try {
        const res = await fetch('/api/user-role', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userId, isAdmin: makeAdmin })
        });
        
        if (res.ok) {
          showModal('success', '操作成功', `用户权限已${makeAdmin ? '提升为管理员' : '降为普通用户'}`);
          loadUsers(); // 重新加载用户列表
        } else {
          const error = await res.text();
          showModal('error', '操作失败', error);
        }
      } catch (error) {
        showModal('error', '操作失败', error.message);
      }
    }
    
    async function deleteUser(userId) {
      if (!confirm('确定要删除这个用户吗？此操作不可撤销！')) {
        return;
      }
      
      try {
        const res = await fetch(`/api/users/${userId}`, {
          method: 'DELETE'
        });
        
        if (res.ok) {
          showModal('success', '删除成功', '用户已被删除');
          loadUsers(); // 重新加载用户列表
        } else {
          const error = await res.text();
          showModal('error', '删除失败', error);
        }
      } catch (error) {
        showModal('error', '删除失败', error.message);
      }
    }

    // 初始化关于页编辑器和内容
    initAboutEditor();
    loadAboutPage();
    
    // 移动端侧边栏控制
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.querySelector('.sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    
    if (sidebarToggle && sidebar && sidebarOverlay) {
      // 切换侧边栏
      sidebarToggle.addEventListener('click', () => {
        sidebar.classList.toggle('open');
      });
      
      // 点击侧边栏菜单项后关闭侧边栏
      const sidebarItems = document.querySelectorAll('.sidebar-item');
      sidebarItems.forEach(item => {
        item.addEventListener('click', () => {
          if (window.innerWidth <= 768) {
            sidebar.classList.remove('open');
          }
        });
      });
    }
  </script>
</body>
</html>
